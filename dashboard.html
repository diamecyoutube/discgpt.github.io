<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>discGPT | Ultimate Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #0b0e14; color: #f3f4f6; overflow-x: hidden; }
        .console-font { font-family: 'JetBrains Mono', monospace; }
        .glass-panel { background: rgba(30, 31, 34, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .gradient-text { background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Custom UI Components */
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #6366f1; }
        input:checked + .slider:before { transform: translateX(22px); }
        
        .hide { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .pulse-premium { animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.2); } 50% { box-shadow: 0 0 15px rgba(139, 92, 246, 0.5); } 100% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.2); } }
    </style>
</head>
<body class="min-h-screen">

    <!-- LOGIN & KEY SECURITY SYSTEM -->
    <div id="login-view" class="min-h-screen flex items-center justify-center p-6">
        <div class="glass-panel p-10 rounded-[2.5rem] w-full max-w-md border-white/10 text-center fade-in">
            <div class="mb-6 mx-auto h-20 w-20 bg-indigo-600 rounded-3xl flex items-center justify-center rotate-6 shadow-xl">
                <span class="text-4xl font-black text-white">DG</span>
            </div>
            <h1 class="text-3xl font-black mb-2">Auth <span class="gradient-text">Protocol</span></h1>
            
            <div id="key-container" class="mt-8 space-y-4">
                <input type="password" id="auth-key" placeholder="Enter License Key" class="w-full bg-black/40 p-4 rounded-2xl outline-none border border-white/5 focus:border-indigo-500 text-center console-font">
                <button onclick="handleLogin()" class="w-full bg-white text-black py-4 rounded-2xl font-black hover:bg-indigo-50 transition active:scale-95">Verify Systems</button>
                
                <!-- Security Feature: Key Deletion & Expiry -->
                <div class="mt-6 p-4 bg-red-500/5 rounded-2xl border border-red-500/10">
                    <div class="flex items-center justify-between text-xs font-bold mb-3">
                        <span class="text-red-400">SESSION LIFETIME</span>
                        <span id="expiry-timer" class="console-font text-white">72:00:00</span>
                    </div>
                    <button onclick="shredKey()" class="w-full py-2 bg-red-500/20 text-red-400 text-[10px] font-black uppercase tracking-widest rounded-lg hover:bg-red-500/40 transition">Shred Access Key Now</button>
                </div>
            </div>
            <p id="login-error" class="text-red-400 text-xs mt-4 hide"></p>
        </div>
    </div>

    <!-- APP WRAPPER (HIDDEN UNTIL LOGIN) -->
    <div id="app-view" class="hide flex">
        <!-- Sidebar -->
        <aside class="w-20 lg:w-64 fixed h-full glass-panel border-r border-white/5 p-4 flex flex-col z-50">
            <div class="p-4 hidden lg:block mb-8">
                <h2 class="text-xl font-black italic">disc<span class="text-indigo-500">GPT</span></h2>
            </div>
            <nav class="flex-1 space-y-2">
                <button onclick="navigate('home')" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl bg-indigo-500/10 text-indigo-400 font-bold">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span class="hidden lg:block">Dashboard</span>
                </button>
                <button onclick="navigate('plans')" class="nav-btn w-full flex items-center gap-3 p-3 rounded-xl text-gray-500 hover:bg-white/5 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <span class="hidden lg:block">Upgrades</span>
                </button>
            </nav>
            <div class="p-4 border-t border-white/5 text-[10px] text-gray-600 font-black">V4.2.0 STABLE</div>
        </aside>

        <!-- Content Area -->
        <main class="ml-20 lg:ml-64 w-full p-6 lg:p-12 overflow-y-auto min-h-screen">
            <!-- Home View -->
            <div id="view-home" class="page-view fade-in">
                <header class="mb-12">
                    <h1 class="text-4xl font-black mb-2">Cluster <span class="gradient-text">Overview</span></h1>
                    <p class="text-gray-500 font-medium">Manage your linked Discord nodes and AI clusters.</p>
                </header>

                <div id="server-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Dynamic Servers -->
                </div>
            </div>

            <!-- Settings View (For a specific server) -->
            <div id="view-settings" class="page-view hide fade-in">
                <header class="flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-10 pb-8 border-b border-white/5">
                    <div>
                        <button onclick="navigate('home')" class="text-indigo-400 text-xs font-black mb-2 flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            RETURN TO CLUSTER
                        </button>
                        <h2 id="current-guild-name" class="text-4xl font-black">Server Name</h2>
                        <div id="tier-badge" class="mt-2 inline-block px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-indigo-500/10 text-indigo-400 border border-indigo-500/20">Free Tier</div>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="openConsole()" class="px-6 py-3 rounded-2xl glass-panel font-bold hover:bg-white/5 transition">Terminal</button>
                        <button onclick="saveChanges()" class="px-8 py-3 rounded-2xl bg-white text-black font-black shadow-lg hover:bg-gray-200 active:scale-95 transition">Deploy Changes</button>
                    </div>
                </header>

                <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
                    <!-- Categories -->
                    <div class="xl:col-span-3 space-y-2">
                        <button onclick="showCat('general')" class="cat-btn w-full text-left p-4 rounded-xl font-bold bg-white/5 text-white">General Configuration</button>
                        <button onclick="showCat('moderation')" class="cat-btn w-full text-left p-4 rounded-xl font-bold text-gray-500 hover:bg-white/5">Automated Defense</button>
                        <button onclick="showCat('ai')" class="cat-btn w-full text-left p-4 rounded-xl font-bold text-gray-500 hover:bg-white/5">Neural AI Logic</button>
                        <button onclick="showCat('plus')" class="cat-btn w-full text-left p-4 rounded-xl font-bold text-yellow-500/80 hover:bg-white/5 flex items-center justify-between">
                            Unlimited Plan
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                        </button>
                    </div>

                    <!-- Options -->
                    <div class="xl:col-span-9" id="settings-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Terminal View -->
            <div id="view-console" class="page-view hide h-[80vh] flex flex-col fade-in">
                <header class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black italic">ssh root@discGPT:~#</h2>
                    <button onclick="navigate('settings')" class="text-xs font-bold text-gray-500 hover:text-white">EXIT TERMINAL</button>
                </header>
                <div class="flex-1 bg-black rounded-[2rem] border border-white/5 overflow-hidden flex flex-col shadow-2xl">
                    <div id="console-output" class="flex-1 p-8 overflow-y-auto console-font text-sm space-y-2 text-gray-400">
                        <div class="text-indigo-400 font-bold">--- discGPT KERNEL v4.2 INITIALIZED ---</div>
                        <div class="text-gray-600 italic">Target Node: <span id="console-node-name">...</span></div>
                    </div>
                    <div class="p-6 bg-white/5 flex gap-4 items-center">
                        <span class="text-indigo-500 font-bold">$</span>
                        <input type="text" id="console-input" class="flex-1 bg-transparent outline-none console-font text-white" placeholder="Type 'help' for available protocols..." onkeydown="if(event.key==='Enter') runCmd()">
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- UI MODALS -->
    <div id="toast" class="fixed bottom-10 right-10 p-5 glass-panel rounded-2xl border-indigo-500/30 hide z-[100] flex items-center gap-4 shadow-2xl">
        <div class="h-2 w-2 rounded-full bg-indigo-500 animate-ping"></div>
        <p id="toast-msg" class="text-sm font-bold"></p>
    </div>

    <script>
        const BOT_URL = "http://fi13.bot-hosting.cloud:21187"; 
        const API_KEY = "bohNFcIumG0hWxp6E8l8b08nubQklL1GURibpKLtAVpUpslFzn";
        
        // APP STATE
        let authPass = "";
        let activeGuild = null;
        let guilds = [];
        let config = {
            prefix: '!',
            welcomer: true,
            ai_channel: '123456789',
            ai_enabled: true,
            anti_spam: true,
            anti_spam_punishment: 'mute', // 'mute', 'kick', 'ban'
            anti_link: false,
            auto_ban_new: false,
            vision: false,
            backups: 0
        };

        // 1. SECURITY SYSTEM
        let expirySeconds = 72 * 3600;
        setInterval(() => {
            if(expirySeconds > 0) {
                expirySeconds--;
                const h = Math.floor(expirySeconds / 3600);
                const m = Math.floor((expirySeconds % 3600) / 60);
                const s = expirySeconds % 60;
                document.getElementById('expiry-timer').innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            } else {
                shredKey();
            }
        }, 1000);

        function shredKey() {
            authPass = "";
            location.reload();
        }

        async function handleLogin() {
            const key = document.getElementById('auth-key').value;
            const err = document.getElementById('login-error');
            if(!key) return;

            try {
                const res = await fetch(`${BOT_URL}/auth?key=${API_KEY}&pass=${key}`);
                const data = await res.json();
                if(!res.ok || data.error) throw new Error(data.error || "Access Denied");

                authPass = key;
                document.getElementById('login-view').classList.add('hide');
                document.getElementById('app-view').classList.remove('hide');
                loadGuilds();
                showToast("Encrypted Link Established");
            } catch(e) {
                err.innerText = e.message;
                err.classList.remove('hide');
            }
        }

        // 2. DATA MANAGEMENT
        async function loadGuilds() {
            const container = document.getElementById('server-list');
            container.innerHTML = `<div class="col-span-3 text-center py-20 text-gray-600 font-bold uppercase tracking-widest">Scanning Network...</div>`;

            try {
                const res = await fetch(`${BOT_URL}/guilds?key=${API_KEY}&pass=${authPass}`);
                guilds = await res.json();
                container.innerHTML = "";
                guilds.forEach(g => {
                    const div = document.createElement('div');
                    div.className = "glass-panel p-6 rounded-[2rem] border-white/5 hover:border-indigo-500/30 transition cursor-pointer flex flex-col items-center text-center";
                    div.onclick = () => selectGuild(g);
                    div.innerHTML = `
                        <div class="h-20 w-20 rounded-3xl bg-black mb-4 flex items-center justify-center overflow-hidden border border-white/10 shadow-xl">
                            <img src="${g.icon || 'https://cdn.discordapp.com/embed/avatars/0.png'}" class="w-full h-full object-cover">
                        </div>
                        <h3 class="font-black text-lg mb-1">${g.name}</h3>
                        <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">${g.tier || 'Free'} Engine</p>
                    `;
                    container.appendChild(div);
                });
            } catch(e) {
                container.innerHTML = `<p class="text-red-400 p-10">Link error: ${e.message}</p>`;
            }
        }

        function selectGuild(g) {
            activeGuild = g;
            document.getElementById('current-guild-name').innerText = g.name;
            document.getElementById('tier-badge').innerText = `${g.tier || 'Free'} Engine`;
            document.getElementById('console-node-name').innerText = g.id;
            navigate('settings');
            showCat('general');
        }

        // 3. NAVIGATION & UI
        function navigate(view) {
            document.querySelectorAll('.page-view').forEach(p => p.classList.add('hide'));
            document.getElementById('view-' + view).classList.remove('hide');
            
            // Sidebar active state
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-500/10', 'text-indigo-400', 'font-bold');
                btn.classList.add('text-gray-500');
            });
            event.currentTarget?.classList?.add('bg-indigo-500/10', 'text-indigo-400', 'font-bold');
        }

        function showCat(cat) {
            const grid = document.getElementById('settings-grid');
            grid.innerHTML = "";
            
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.classList.remove('bg-white/5', 'text-white');
                b.classList.add('text-gray-500');
            });
            event.currentTarget.classList.add('bg-white/5', 'text-white');

            const options = {
                general: [
                    { key: 'prefix', label: 'Command Prefix', type: 'text', help: 'The symbol that triggers bot commands.' },
                    { key: 'welcomer', label: 'Welcome Protocol', type: 'toggle', help: 'Greets new members with AI-generated greetings.' },
                    { key: 'nick_lock', label: 'Nickname Lockdown', type: 'toggle', help: 'Prevents staff from changing bot nickname.' }
                ],
                moderation: [
                    { key: 'anti_spam', label: 'Neural Anti-Spam', type: 'toggle', help: 'AI analysis of message frequency.' },
                    { key: 'anti_spam_punishment', label: 'Punishment Protocol', type: 'select', options: ['Mute', 'Kick', 'Ban'], help: 'Action taken when spam is detected.' },
                    { key: 'anti_link', label: 'URL Filtering', type: 'toggle', help: 'Deletes unauthorized invite links.' },
                    { key: 'auto_mod_strict', label: 'Strict Verification', type: 'toggle', help: 'Kicks accounts less than 24h old.' }
                ],
                ai: [
                    { key: 'ai_enabled', label: 'Global AI Interaction', type: 'toggle', help: 'Allow users to use /ask and mentions.' },
                    { key: 'ai_channel', label: 'Auto-Reply Channel ID', type: 'text', help: 'Bot responds to EVERY message here.' },
                    { key: 'ai_bypass_roles', label: 'Bypass Admin Filter', type: 'toggle', help: 'Admins ignore AI toxicity filters.' }
                ],
                plus: [
                    { key: 'vision', label: 'Image Analysis', type: 'toggle', premium: true, help: 'Allows bot to "see" uploaded images.' },
                    { key: 'failover', label: 'Infinite Backups', type: 'toggle', premium: true, help: 'Failover to Llama if Gemini is down.' },
                    { key: 'web_search', label: 'Live Web Search', type: 'toggle', premium: true, help: 'Bot can research real-time news.' }
                ]
            };

            options[cat].forEach(opt => {
                const card = document.createElement('div');
                card.className = "glass-panel p-6 rounded-2xl mb-4 border-white/5 flex items-center justify-between";
                
                let inputHtml = "";
                if(opt.type === 'toggle') {
                    inputHtml = `<label class="switch"><input type="checkbox" onchange="updateLocal('${opt.key}', this.checked)" ${config[opt.key] ? 'checked' : ''} ${opt.premium && activeGuild.tier === 'Free' ? 'disabled' : ''}><span class="slider"></span></label>`;
                } else if(opt.type === 'select') {
                    inputHtml = `<select onchange="updateLocal('${opt.key}', this.value.toLowerCase())" class="bg-black/40 border border-white/10 rounded-lg p-2 text-xs outline-none">${opt.options.map(o => `<option ${config[opt.key] === o.toLowerCase() ? 'selected' : ''}>${o}</option>`).join('')}</select>`;
                } else {
                    inputHtml = `<input type="text" value="${config[opt.key] || ''}" oninput="updateLocal('${opt.key}', this.value)" placeholder="Enter value..." class="bg-black/40 border border-white/10 rounded-lg p-2 text-xs outline-none focus:border-indigo-500 w-40 text-right">`;
                }

                card.innerHTML = `
                    <div>
                        <h4 class="font-bold text-sm mb-1">${opt.label} ${opt.premium ? 'ðŸ’Ž' : ''}</h4>
                        <p class="text-[10px] text-gray-500">${opt.help}</p>
                    </div>
                    ${inputHtml}
                `;
                grid.appendChild(card);
            });
        }

        function updateLocal(key, val) {
            config[key] = val;
            console.log("State Updated:", key, val);
        }

        async function saveChanges() {
            showToast("Syncing with Global Cluster...");
            try {
                // In a real app, you'd POST this config to your backend
                await new Promise(r => setTimeout(r, 1000));
                showToast("Configuration Applied Successfully");
            } catch(e) {
                showToast("Deployment Failed: Node Unreachable", true);
            }
        }

        // 4. TERMINAL PROTOCOLS
        function openConsole() {
            navigate('console');
            document.getElementById('console-input').focus();
        }

        function tWrite(txt, type="sys") {
            const out = document.getElementById('console-output');
            const color = { sys: 'text-gray-500', err: 'text-red-500', ok: 'text-green-500', cmd: 'text-white' }[type];
            out.innerHTML += `<div class="${color} mb-1">[${new Date().toLocaleTimeString()}] ${txt}</div>`;
            out.scrollTop = out.scrollHeight;
        }

        async function runCmd() {
            const input = document.getElementById('console-input');
            const raw = input.value.trim();
            if(!raw) return;
            input.value = "";

            const [cmd, ...args] = raw.split(" ");
            tWrite(`$ ${raw}`, 'cmd');

            if(cmd === 'help') {
                tWrite("--- DISCGPT CORE PROTOCOLS ---");
                tWrite("MOD: ban, kick, mute, purge, warn, lock, unlock");
                tWrite("AI: ai-ban, ai-status, ai-reset, ask, analyze");
                tWrite("SYS: stats, cluster, reboot, shred-logs");
                return;
            }

            if(cmd === 'ask') {
                tWrite("Connecting to Gemini 3 Flash...", "sys");
                tWrite("AI RESPONSE: To use AI, ensure the Unlimited Plan is active and your Neural API keys are valid.", "ok");
                return;
            }

            // Simulated Remote Exec
            tWrite(`Executing ${cmd} on Node ${activeGuild.id}...`, 'sys');
            setTimeout(() => tWrite(`Protocol ${cmd} finished with exit code 0.`, 'ok'), 600);
        }

        function showToast(msg, isErr = false) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            document.getElementById('toast-msg').className = `text-sm font-bold ${isErr ? 'text-red-400' : 'text-indigo-400'}`;
            t.classList.remove('hide');
            setTimeout(() => t.classList.add('hide'), 3000);
        }
    </script>
</body>
</html>
